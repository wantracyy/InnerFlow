{% extends 'base.html' %}

{% block title %}
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | InnerFlow
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="card shadow-sm border-0">
            <div class="card-body p-4 p-md-5">
                <!-- –õ–æ–≥–æ—Ç–∏–ø -->
                <div class="text-center mb-4">
                    <img class="header__img" src="{{ url_for('static', filename='img/logotip.png') }}" alt="InnerFlow" width="80" height="80">
                </div>

                <h2 class="text-center mb-4">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>

                <!-- –ë–∞–Ω–Ω–µ—Ä –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ -->
                <div class="alert alert-info border-0 mb-4">
                    <small class="d-block">
                        <strong>üîí –í–∞—à–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî –Ω–∞—à –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</strong>
                    </small>
                    <small>–ú—ã –Ω–µ —Å–æ–±–∏—Ä–∞–µ–º email, —Ç–µ–ª–µ—Ñ–æ–Ω—ã –∏–ª–∏ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –¢–æ–ª—å–∫–æ –≤–∞—à –Ω–∏–∫ –∏ –ø–∞—Ä–æ–ª—å.</small>
                </div>

                <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                <form id="quickRegisterForm">
                    <!-- –ü–æ–ª–µ –¥–ª—è –Ω–∏–∫–∞ -->
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="username" name="username"
                               placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∏–∫" required maxlength="20">
                        <label for="username">–í–∞—à –Ω–∏–∫</label>
                    </div>

                    <!-- –ü–æ–ª–µ –¥–ª—è –ø–∞—Ä–æ–ª—è -->
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" id="password" name="password"
                               placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" required minlength="6">
                        <label for="password">–ü–∞—Ä–æ–ª—å</label>
                        <div class="form-text">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
                    </div>

                    <!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è -->
                    <div class="form-floating mb-4">
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"
                               placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required minlength="6">
                        <label for="confirmPassword">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–µ–Ω–∏–∏ -->
                    <div class="alert alert-warning border-0 mb-4">
                        <small class="d-block">
                            <strong>üíæ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</strong>
                        </small>
                        <small>–í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</small>
                    </div>

                    <button class="btn btn-primary w-100 py-2 mb-3" type="submit">
                        –ù–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                    </button>

                    <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –≤—Ö–æ–¥ -->
                    <div class="text-center">
                        <small class="text-muted">
                            –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="{{ url_for('login_page') }}" class="text-decoration-none">–í–æ–π—Ç–∏</a>
                        </small>
                    </div>
                </form>
            </div>
        </div>

        <div class="text-center mt-4">
            <small class="text-body-secondary">¬© 2025 InnerFlow</small>
        </div>
    </div>
</div>

<style>
.auth-container {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.auth-card {
    width: 100%;
    max-width: 400px;
}
</style>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('quickRegisterForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            alert('–û—à–∏–±–∫–∞: –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
            return;
        }

        if (password.length < 6) {
            alert('–û—à–∏–±–∫–∞: –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤');
            return;
        }

        fetch('/quick-register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                username: username,
                password: password
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                window.location.href = data.redirect_to || '/main';
            } else {
                alert('–û—à–∏–±–∫–∞: ' + data.error);
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
        });
    });

    document.getElementById('confirmPassword').addEventListener('input', function() {
        const password = document.getElementById('password').value;
        const confirmPassword = this.value;

        if (confirmPassword && password !== confirmPassword) {
            this.classList.add('is-invalid');
            this.classList.remove('is-valid');
        } else if (confirmPassword) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } else {
            this.classList.remove('is-invalid', 'is-valid');
        }
    });
</script>
{% endblock %}